var E=new Map,V={get:(q)=>{let F=q.startsWith("--")?q:`--${q}`;if(E.has(F))return E.get(F);let J=getComputedStyle(document.documentElement).getPropertyValue(F).trim();if(!J)return console.warn(`CSS variable ${F} not found or empty`),"#000000";return E.set(F,J),J},set:(q,F)=>{let J=q.startsWith("--")?q:`--${q}`;if(E.get(J)!==F)document.documentElement.style.setProperty(J,F),E.set(J,F)},clearCache:()=>{E.clear()},hexToRgb:(q)=>{if(q=q.replace(/^#/,""),q.length===3)q=q.split("").map((J)=>J+J).join("");let F=parseInt(q,16);return{r:F>>16&255,g:F>>8&255,b:F&255}},lightenColor:(q,F)=>{let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.min(Math.floor(K*(1+F/100)),255),$=Math.min(Math.floor(Q*(1+F/100)),255),j=Math.min(Math.floor(T*(1+F/100)),255);return`rgb(${_}, ${$}, ${j})`},darkenColor:(q,F)=>{let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.max(Math.floor(K*(1-F/100)),0),$=Math.max(Math.floor(Q*(1-F/100)),0),j=Math.max(Math.floor(T*(1-F/100)),0);return`rgb(${_}, ${$}, ${j})`},isLightColor:(q)=>{let F=q.replace("#",""),J=parseInt(F.substr(0,2),16),K=parseInt(F.substr(2,2),16),Q=parseInt(F.substr(4,2),16);return(J*299+K*587+Q*114)/1000>125}};var Z={gridSize:10,cellSize:40,get colors(){return[V.get("color-teal"),V.get("color-light-brown")]},get highlightColor(){return V.get("highlight-color")},get invalidColor(){return V.get("invalid-color")},pieceAreaHeight:150,pieceSize:80,pieceMargin:20,maxAvailablePieces:3,gameOverButton:{width:200,height:60,get color(){return V.get("button-background")},get hoverColor(){return V.get("button-hover")},get textColor(){return V.get("button-text")},font:"20px Arial",text:"Play Again"},get backgroundColor(){return V.get("background-color")},get gridLineColor(){return V.get("grid-line-color")},get textColor(){return V.get("text-color")},get borderColor(){return V.get("border-color")}};var U;((k)=>{let q=[{name:"Line",pattern:[[!0,!0,!0,!0]]},{name:"Square2x2",pattern:[[!0,!0],[!0,!0]]},{name:"TShape",pattern:[[!1,!0,!1],[!0,!0,!0]]},{name:"LShape",pattern:[[!0,!1],[!0,!1],[!0,!0]]},{name:"ZShape",pattern:[[!0,!0,!1],[!1,!0,!0]]},{name:"Single",pattern:[[!0]]},{name:"SmallL",pattern:[[!0,!1],[!0,!0]]},{name:"Square3x3",pattern:[[!0,!0,!0],[!0,!0,!0],[!0,!0,!0]]}];function F(){return[...q]}k.all=F;function J(){return q[Math.floor(Math.random()*q.length)]}k.random=J;function K(T){return q.find((_)=>_.name===T)}k.byName=K;function Q(){return J().pattern}k.randomPattern=Q})(U||={});class I{shape;color;x;y;isAvailable;shapeName;constructor(q,F){if(this.color=Z.colors[Math.floor(Math.random()*Z.colors.length)],this.x=0,this.y=0,this.isAvailable=!0,q)this.shape=q,this.shapeName="custom";else{let J=U.random();this.shape=J.pattern,this.shapeName=J.name}if(F!==void 0){let J=Z.gridSize*Z.cellSize,K=this.shape[0].length*Z.cellSize,Q=J/Z.maxAvailablePieces;this.x=Q/2-K/2+F*Q;let T=Z.gridSize*Z.cellSize,_=this.shape.length*Z.cellSize;this.y=T+Z.pieceAreaHeight/2-_/2}}generateRandomShape(){return U.randomPattern()}contains(q,F){let J=Z.cellSize,K=this.x,Q=this.x+this.shape[0].length*J,T=this.y,_=this.y+this.shape.length*J;if(q>=K&&q<Q&&F>=T&&F<_){let $=Math.floor((q-this.x)/J),j=Math.floor((F-this.y)/J);if($>=0&&$<this.shape[0].length&&j>=0&&j<this.shape.length)return this.shape[j][$]}return!1}render(q){let F=Z.cellSize;for(let J=0;J<this.shape.length;J++)for(let K=0;K<this.shape[J].length;K++)if(this.shape[J][K]){let Q=this.x+K*F,T=this.y+J*F;this.drawBlockWithEffect(q,Q,T,F)}}drawBlockWithEffect(q,F,J,K){q.fillStyle=this.color,q.fillRect(F,J,K,K),q.fillStyle=this.lightenColor(this.color,15),q.beginPath(),q.moveTo(F,J),q.lineTo(F+K,J),q.lineTo(F+K-4,J+4),q.lineTo(F+4,J+4),q.closePath(),q.fill(),q.fillStyle=this.darkenColor(this.color,15),q.beginPath(),q.moveTo(F+K,J),q.lineTo(F+K,J+K),q.lineTo(F+K-4,J+K-4),q.lineTo(F+K-4,J+4),q.closePath(),q.fill(),q.fillStyle=this.darkenColor(this.color,25),q.beginPath(),q.moveTo(F,J+K),q.lineTo(F+K,J+K),q.lineTo(F+K-4,J+K-4),q.lineTo(F+4,J+K-4),q.closePath(),q.fill(),q.fillStyle=this.lightenColor(this.color,5),q.beginPath(),q.moveTo(F,J),q.lineTo(F,J+K),q.lineTo(F+4,J+K-4),q.lineTo(F+4,J+4),q.closePath(),q.fill(),q.strokeStyle="#3F3A33",q.lineWidth=1,q.strokeRect(F,J,K,K),this.drawSymbolOnBlock(q,F,J,K)}drawSymbolOnBlock(q,F,J,K){let Q=K*0.2,T=K-Q*2,_=this.isLightColor(this.color);switch(q.fillStyle=_?this.darkenColor(this.color,30):this.lightenColor(this.color,30),q.strokeStyle=_?this.darkenColor(this.color,30):this.lightenColor(this.color,30),q.lineWidth=2,this.shapeName){case"Line":q.beginPath(),q.moveTo(F+Q,J+K/2),q.lineTo(F+K-Q,J+K/2),q.stroke();break;case"Square2x2":q.strokeRect(F+Q,J+Q,T,T);break;case"TShape":q.beginPath(),q.moveTo(F+K/2,J+Q),q.lineTo(F+K/2,J+K-Q),q.moveTo(F+Q,J+Q),q.lineTo(F+K-Q,J+Q),q.stroke();break;case"LShape":q.beginPath(),q.moveTo(F+Q+T/3,J+Q),q.lineTo(F+Q+T/3,J+K-Q),q.lineTo(F+K-Q,J+K-Q),q.stroke();break;case"ZShape":q.beginPath(),q.moveTo(F+Q,J+Q),q.lineTo(F+K-Q,J+Q),q.lineTo(F+Q,J+K-Q),q.lineTo(F+K-Q,J+K-Q),q.stroke();break;case"Single":q.beginPath(),q.arc(F+K/2,J+K/2,T/5,0,Math.PI*2),q.fill();break;case"SmallL":q.beginPath(),q.moveTo(F+Q+T/3,J+Q),q.lineTo(F+Q+T/3,J+K-Q),q.lineTo(F+K-Q,J+K-Q),q.stroke();break;case"Square3x3":q.strokeRect(F+Q,J+Q,T,T),q.strokeRect(F+Q+T/4,J+Q+T/4,T/2,T/2);break;default:q.beginPath(),q.arc(F+K/2,J+K/2,T/3,0,Math.PI*2),q.stroke()}}lightenColor(q,F){let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.min(Math.floor(K*(1+F/100)),255),$=Math.min(Math.floor(Q*(1+F/100)),255),j=Math.min(Math.floor(T*(1+F/100)),255);return`rgb(${_}, ${$}, ${j})`}darkenColor(q,F){let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.max(Math.floor(K*(1-F/100)),0),$=Math.max(Math.floor(Q*(1-F/100)),0),j=Math.max(Math.floor(T*(1-F/100)),0);return`rgb(${_}, ${$}, ${j})`}isLightColor(q){let F=q.replace("#",""),J=parseInt(F.substr(0,2),16),K=parseInt(F.substr(2,2),16),Q=parseInt(F.substr(4,2),16);return(J*299+K*587+Q*114)/1000>125}}function A(q){let F=document.getElementById("score");if(F)F.textContent=q.toString()}function L(q,F){for(let J=0;J<F.length;J++)if(F[J].isAvailable)F[J].render(q)}function P(q,F){let K=q.canvas.width,Q=Z.gridSize*Z.cellSize;q.fillStyle="rgba(0, 0, 0, 0.7)",q.fillRect(0,0,K,Q+Z.pieceAreaHeight),q.font="36px Arial",q.fillStyle="white",q.textAlign="center",q.textBaseline="middle",q.fillText("Game Over!",K/2,Q/3),q.font="28px Arial",q.fillText(`Final Score: ${F}`,K/2,Q/2)}function O(q,F){let K=q.canvas.width,Q=Z.gridSize*Z.cellSize,T=Z.gameOverButton,_=(K-T.width)/2,$=Q*0.65;q.fillStyle=F?T.hoverColor:T.color,q.strokeStyle="rgba(0, 0, 0, 0.3)",q.lineWidth=2;let j=8;return q.beginPath(),q.moveTo(_+j,$),q.lineTo(_+T.width-j,$),q.quadraticCurveTo(_+T.width,$,_+T.width,$+j),q.lineTo(_+T.width,$+T.height-j),q.quadraticCurveTo(_+T.width,$+T.height,_+T.width-j,$+T.height),q.lineTo(_+j,$+T.height),q.quadraticCurveTo(_,$+T.height,_,$+T.height-j),q.lineTo(_,$+j),q.quadraticCurveTo(_,$,_+j,$),q.closePath(),q.fill(),q.stroke(),q.font=T.font,q.fillStyle=T.textColor,q.textAlign="center",q.textBaseline="middle",q.fillText(T.text,_+T.width/2,$+T.height/2),{x:_,y:$,width:T.width,height:T.height}}function N(q,F,J,K,Q,T){return q>=J&&q<=J+Q&&F>=K&&F<=K+T}class M{canvas;ctx;cells;score;constructor(q,F=0){this.canvas=q,this.ctx=q.getContext("2d"),this.score=F,this.cells=Array(Z.gridSize).fill(null).map(()=>Array(Z.gridSize).fill(null)),this.render()}render(){let q=this.ctx,F=Z.cellSize,J=Z.gridSize*F;q.fillStyle=Z.backgroundColor,q.fillRect(0,0,this.canvas.width,this.canvas.height),q.strokeStyle=Z.gridLineColor,q.lineWidth=1;for(let K=0;K<=Z.gridSize;K++)q.beginPath(),q.moveTo(0,K*F),q.lineTo(this.canvas.width,K*F),q.stroke(),q.beginPath(),q.moveTo(K*F,0),q.lineTo(K*F,J),q.stroke();for(let K=0;K<Z.gridSize;K++)for(let Q=0;Q<Z.gridSize;Q++){let T=this.cells[K][Q];if(T){q.fillStyle=T,q.strokeStyle="#3F3A33",q.lineWidth=2;let _=Q*F,$=K*F;q.fillRect(_,$,F,F),q.fillStyle=this.lightenColor(T,15),q.beginPath(),q.moveTo(_,$),q.lineTo(_+F,$),q.lineTo(_+F-4,$+4),q.lineTo(_+4,$+4),q.closePath(),q.fill(),q.fillStyle=this.darkenColor(T,15),q.beginPath(),q.moveTo(_+F,$),q.lineTo(_+F,$+F),q.lineTo(_+F-4,$+F-4),q.lineTo(_+F-4,$+4),q.closePath(),q.fill(),q.strokeRect(_,$,F,F)}}q.beginPath(),q.strokeStyle=Z.borderColor,q.lineWidth=2,q.moveTo(0,J),q.lineTo(this.canvas.width,J),q.stroke(),q.font="16px Arial",q.fillStyle=Z.textColor,q.textAlign="center",q.fillText("Available Pieces",this.canvas.width/2,J+20)}lightenColor(q,F){let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.min(Math.floor(K*(1+F/100)),255),$=Math.min(Math.floor(Q*(1+F/100)),255),j=Math.min(Math.floor(T*(1+F/100)),255);return`rgb(${_}, ${$}, ${j})`}darkenColor(q,F){let J=q.replace("#",""),K=parseInt(J.substr(0,2),16),Q=parseInt(J.substr(2,2),16),T=parseInt(J.substr(4,2),16),_=Math.max(Math.floor(K*(1-F/100)),0),$=Math.max(Math.floor(Q*(1-F/100)),0),j=Math.max(Math.floor(T*(1-F/100)),0);return`rgb(${_}, ${$}, ${j})`}canPlacePiece(q,F,J){for(let K=0;K<q.shape.length;K++)for(let Q=0;Q<q.shape[K].length;Q++)if(q.shape[K][Q]){let T=F+Q,_=J+K;if(T<0||T>=Z.gridSize||_<0||_>=Z.gridSize)return!1;if(this.cells[_][T]!==null)return!1}return!0}placePiece(q,F,J){if(!this.canPlacePiece(q,F,J))return!1;for(let K=0;K<q.shape.length;K++)for(let Q=0;Q<q.shape[K].length;Q++)if(q.shape[K][Q])this.cells[J+K][F+Q]=q.color;return this.render(),this.checkForCompleteLines(),!0}highlightValidPlacement(q,F,J,K){if(!q)return;let Q=Z.cellSize,T=this.canPlacePiece(q,F,J);K.globalAlpha=0.3,K.fillStyle=T?Z.highlightColor:Z.invalidColor;for(let _=0;_<q.shape.length;_++)for(let $=0;$<q.shape[_].length;$++)if(q.shape[_][$]){let j=F*Q+$*Q,D=J*Q+_*Q;K.fillRect(j,D,Q,Q)}K.globalAlpha=1}checkForCompleteLines(){let q=0;for(let F=0;F<Z.gridSize;F++)if(this.cells[F].every((J)=>J!==null))this.cells[F]=Array(Z.gridSize).fill(null),q++;for(let F=0;F<Z.gridSize;F++)if(this.cells.map((K)=>K[F]).every((K)=>K!==null)){for(let K=0;K<Z.gridSize;K++)this.cells[K][F]=null;q++}if(q>0)this.score+=Math.pow(q,2)*100,A(this.score),this.render();return q}}class W{score=0;isDragging=!1;activePiece=null;dragStartX=0;dragStartY=0;dragCurrentX=0;dragCurrentY=0;animationFrameId=null;availablePieces=[];isGameOver=!1;finalScore=0;hoveringPlayButton=!1;grid;mainCanvas;overlayCanvas;mainCtx;overlayCtx;constructor(){this.mainCanvas=document.getElementById("main-canvas"),this.overlayCanvas=document.getElementById("overlay-canvas"),this.mainCtx=this.mainCanvas.getContext("2d"),this.overlayCtx=this.overlayCanvas.getContext("2d");let q=Z.gridSize*Z.cellSize+Z.pieceAreaHeight;this.mainCanvas.width=Z.gridSize*Z.cellSize,this.mainCanvas.height=q,this.overlayCanvas.width=Z.gridSize*Z.cellSize,this.overlayCanvas.height=q,this.grid=new M(this.mainCanvas,this.score),this.setupEventListeners()}initialize(){this.generateInitialPieces(),L(this.overlayCtx,this.availablePieces)}setupEventListeners(){this.overlayCanvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.overlayCanvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.setupGameOverEvents(),document.getElementById("new-game-btn")?.addEventListener("click",this.newGame.bind(this))}generateInitialPieces(){for(let q=0;q<Z.maxAvailablePieces;q++)this.generateNewPiece()}generateNewPiece(){for(let q=0;q<Z.maxAvailablePieces;q++)if(!this.availablePieces[q]||!this.availablePieces[q].isAvailable){let F=new I(void 0,q);if(q<this.availablePieces.length)this.availablePieces[q]=F;else this.availablePieces.push(F);return}}animateDrag(){if(this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),L(this.overlayCtx,this.availablePieces),this.isDragging&&this.activePiece){let q=Z.cellSize,F=this.dragCurrentX-this.dragStartX,J=this.dragCurrentY-this.dragStartY;this.activePiece.x+=F,this.activePiece.y+=J,this.dragStartX=this.dragCurrentX,this.dragStartY=this.dragCurrentY;let K=this.activePiece.shape[0].length*q,Q=this.activePiece.shape.length*q,T=this.activePiece.x+K/2,_=this.activePiece.y+Q/2,$=Math.floor(T/q),j=Math.floor(_/q),D=j<Z.gridSize&&$<Z.gridSize;if(this.activePiece.render(this.overlayCtx),D){let w=Math.floor($-Math.floor(this.activePiece.shape[0].length/2)),R=Math.floor(j-Math.floor(this.activePiece.shape.length/2));this.grid.highlightValidPlacement(this.activePiece,w,R,this.overlayCtx)}this.animationFrameId=requestAnimationFrame(this.animateDrag.bind(this))}else if(this.animationFrameId!==null)cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null}findPieceAtPosition(q,F){for(let J=this.availablePieces.length-1;J>=0;J--){let K=this.availablePieces[J];if(K.isAvailable&&K.contains(q,F))return K}return null}tryPlacePiece(q,F){if(!this.activePiece)return;if(this.grid.placePiece(this.activePiece,q,F))this.activePiece.isAvailable=!1,this.score=this.grid.score,this.generateNewPiece(),this.checkGameOver();else this.repositionAvailablePieces()}repositionAvailablePieces(){for(let q=0;q<this.availablePieces.length;q++)if(this.availablePieces[q].isAvailable){let F=Z.gridSize*Z.cellSize,J=this.availablePieces[q].shape[0].length*Z.cellSize,K=this.availablePieces.filter(($)=>$.isAvailable).length,Q=F/Z.maxAvailablePieces;this.availablePieces[q].x=Q/2-J/2+q*Q;let T=Z.gridSize*Z.cellSize,_=this.availablePieces[q].shape.length*Z.cellSize;this.availablePieces[q].y=T+Z.pieceAreaHeight/2-_/2}}checkGameOver(){let q=!1;for(let F of this.availablePieces){if(!F.isAvailable)continue;for(let J=0;J<Z.gridSize;J++)for(let K=0;K<Z.gridSize;K++)if(this.grid.canPlacePiece(F,K,J)){q=!0;return}}if(!q){if(this.isGameOver=!0,this.finalScore=this.score,P(this.mainCtx,this.finalScore),this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),O(this.overlayCtx,!1),this.animationFrameId!==null)cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null}}newGame(){this.score=0,this.isGameOver=!1,document.getElementById("score").textContent="0",this.grid=new M(this.mainCanvas,this.score),this.availablePieces=[];for(let q=0;q<Z.maxAvailablePieces;q++)this.generateNewPiece();this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),L(this.overlayCtx,this.availablePieces)}setupGameOverEvents(){this.overlayCanvas.addEventListener("mousemove",(q)=>{if(!this.isGameOver)return;let F=this.overlayCanvas.getBoundingClientRect(),J=(q.clientX-F.left)*(this.overlayCanvas.width/F.width),K=(q.clientY-F.top)*(this.overlayCanvas.height/F.height),Q=O(this.overlayCtx,!1),T=N(J,K,Q.x,Q.y,Q.width,Q.height);if(T!==this.hoveringPlayButton)this.hoveringPlayButton=T,this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),O(this.overlayCtx,T)}),this.overlayCanvas.addEventListener("click",(q)=>{if(!this.isGameOver)return;let F=this.overlayCanvas.getBoundingClientRect(),J=(q.clientX-F.left)*(this.overlayCanvas.width/F.width),K=(q.clientY-F.top)*(this.overlayCanvas.height/F.height),Q=O(this.overlayCtx,!1);if(N(J,K,Q.x,Q.y,Q.width,Q.height))this.newGame()})}handleMouseDown(q){if(this.isGameOver)return;let F=this.overlayCanvas.getBoundingClientRect(),J=(q.clientX-F.left)*(this.overlayCanvas.width/F.width),K=(q.clientY-F.top)*(this.overlayCanvas.height/F.height),Q=this.findPieceAtPosition(J,K);if(Q){if(q.preventDefault(),this.activePiece=Q,this.isDragging=!0,this.dragStartX=J,this.dragStartY=K,this.dragCurrentX=J,this.dragCurrentY=K,this.animationFrameId===null)this.animationFrameId=requestAnimationFrame(this.animateDrag.bind(this));document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this))}}handleMouseMove(q){if(this.isDragging&&this.activePiece){let F=this.overlayCanvas.getBoundingClientRect();document.body.style.cursor="grabbing",this.dragCurrentX=(q.clientX-F.left)*(this.overlayCanvas.width/F.width),this.dragCurrentY=(q.clientY-F.top)*(this.overlayCanvas.height/F.height)}}handleMouseUp(q){if(this.isDragging&&this.activePiece){let F=Z.cellSize,J=this.activePiece.shape[0].length*F,K=this.activePiece.shape.length*F,Q=this.activePiece.x+J/2,T=this.activePiece.y+K/2,_=Math.floor(Q/F),$=Math.floor(T/F),j=Math.floor(_-Math.floor(this.activePiece.shape[0].length/2)),D=Math.floor($-Math.floor(this.activePiece.shape.length/2));if($<Z.gridSize&&_<Z.gridSize)this.tryPlacePiece(j,D);else this.repositionAvailablePieces();document.body.style.cursor="default",this.isDragging=!1,this.activePiece=null,this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),L(this.overlayCtx,this.availablePieces),document.removeEventListener("mousemove",this.handleMouseMove.bind(this)),document.removeEventListener("mouseup",this.handleMouseUp.bind(this))}}handleTouchStart(q){if(q.touches.length>0){let F=this.overlayCanvas.getBoundingClientRect(),J=q.touches[0],K=(J.clientX-F.left)*(this.overlayCanvas.width/F.width),Q=(J.clientY-F.top)*(this.overlayCanvas.height/F.height),T=this.findPieceAtPosition(K,Q);if(T){if(q.preventDefault(),this.activePiece=T,this.isDragging=!0,this.dragStartX=K,this.dragStartY=Q,this.dragCurrentX=K,this.dragCurrentY=Q,this.animationFrameId===null)this.animationFrameId=requestAnimationFrame(this.animateDrag.bind(this));document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this))}}}handleTouchMove(q){if(q.touches.length>0&&this.isDragging&&this.activePiece){q.preventDefault();let F=q.touches[0],J=this.overlayCanvas.getBoundingClientRect();this.dragCurrentX=(F.clientX-J.left)*(this.overlayCanvas.width/J.width),this.dragCurrentY=(F.clientY-J.top)*(this.overlayCanvas.height/J.height)}}handleTouchEnd(q){if(this.isDragging&&this.activePiece){let F=Z.cellSize,J=this.activePiece.shape[0].length*F,K=this.activePiece.shape.length*F,Q=this.activePiece.x+J/2,T=this.activePiece.y+K/2,_=Math.floor(Q/F),$=Math.floor(T/F),j=Math.floor(_-Math.floor(this.activePiece.shape[0].length/2)),D=Math.floor($-Math.floor(this.activePiece.shape.length/2));if($<Z.gridSize&&_<Z.gridSize)this.tryPlacePiece(j,D);else this.repositionAvailablePieces();this.isDragging=!1,this.activePiece=null,this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),L(this.overlayCtx,this.availablePieces),document.removeEventListener("touchmove",this.handleTouchMove.bind(this)),document.removeEventListener("touchend",this.handleTouchEnd.bind(this))}}}window.addEventListener("DOMContentLoaded",()=>{new W().initialize()});
