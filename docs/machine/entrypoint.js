var a=(t)=>document.querySelector(t),d=new Worker(new URL("kernel.js",import.meta.url)),p=()=>{let t=new Map;return{get:(e,n)=>{if(t.has(e))return t.get(e);let c=n();return t.set(e,c),c},set:(e,n)=>{t.set(e,n)}}},x=()=>getComputedStyle(document.documentElement),o=(()=>{let t=p();return{get:(e)=>{return t.get(e,()=>x().getPropertyValue(e))},set:(e,n)=>{t.set(e,n)}}})(),i=[o.get("--color-black"),o.get("--color-white"),o.get("--color-red"),o.get("--color-green"),o.get("--color-blue"),o.get("--color-yellow"),o.get("--color-cyan"),o.get("--color-magenta"),o.get("--color-gray"),o.get("--color-light-gray"),o.get("--color-dark-gray"),o.get("--color-light-red"),o.get("--color-light-green"),o.get("--color-light-blue"),o.get("--color-light-yellow"),o.get("--color-light-cyan")],{canvas:w,ctx:l}=(()=>{let t=a(".screen");if(!t)throw new Error("Canvas not found");let e=t.getContext("2d");if(!e)throw new Error("Canvas context not found");return{canvas:t,ctx:e}})(),s={canvas:w,ctx:l,width:800,height:600},C=(t)=>{let v=t.memory[4093],m=t.memory[4094],u=t.memory[4095],g=t.memory.slice(4096,5384);s.ctx.fillStyle=i[u]||"black",s.ctx.fillRect(0,0,s.width,s.height),s.ctx.font=`18px ${o.get("--font-family")}`;for(let r=0;r<g.length;r++){let f=g[r],h=r%56*13+38,y=Math.floor(r/56)*23+38;l.fillStyle=i[m]||"white",l.fillText(String.fromCharCode(f),h,y+12)}};d.onmessage=(t)=>{if(!t.data)return;let{type:e}=t.data;if(e==="tick"){let n=t.data.cpu;C(n)}else if(e==="state")a("#fps-text").innerHTML=t.data.state.delta,a("#status-text").innerHTML=t.data.state.halt?"Halted":"Running";else console.log("Unknown message type",t)};d.postMessage({type:"start"});
